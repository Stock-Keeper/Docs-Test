---
type: ui
phase: P3
component: 토큰 차감 확인 모달
related:
  api:
    - specs/api/portfolio/ai-optimize.md
    - specs/api/portfolio/backtest.md
    - specs/api/community/portfolio-copy.md
  ui:
    - specs/ui/_shared/modal.md
    - specs/ui/bm/shop.md
---

# 토큰 차감 확인 모달 (Token Deduction Modal)

## 개요

프리미엄 기능(AI 최적화, 백테스팅, 포트폴리오 복사 등) 실행 시 사용자의 토큰을 소모하거나 멤버십 횟수를 차감하기 전, 최종 동의를 얻는 공통 모달 다이얼로그.

## 레이아웃

### 1. 토큰 충분 / 한도 내 (진행 가능)

```
┌─────────────────────────────────┐
│  (반투명 배경 오버레이)           │
│                                 │
├─────────────────────────────────┤
│  ────                           │
│                                 │
│  🪙 토큰 사용 확인               │
│  ─────────────────────────────  │
│  AI 포트폴리오 비중 최적화를      │
│  실행하시겠습니까?                │
│                                 │
│  [사용 후 잔여: 145 🪙]           │
│  (-5 🪙 차감)                    │
│                                 │
│  [취소하기]       [사용하기]      │
└─────────────────────────────────┘
```

> **멤버십 사용 시 문구 변형**:
> "PRO 멤버십 혜택으로 실행합니다."
> "[이번 달 잔여 백테스팅: 14/15회]"

---

### 2. 토큰 부족 (진행 불가)

```
┌─────────────────────────────────┐
│  (반투명 배경 오버레이)           │
│                                 │
├─────────────────────────────────┤
│  ────                           │
│                                 │
│  ⚠️ 토큰이 부족합니다            │
│  ─────────────────────────────  │
│  기능을 실행하기 위해 5 🪙가      │
│  필요하지만, 현재 잔액이          │
│  부족합니다.                     │
│                                 │
│  [현재 보유: 2 🪙]               │
│                                 │
│  [취소]          [상점으로 가기]  │
└─────────────────────────────────┘
```

## 컴포넌트

### 1. 타이틀 영역
- 아이콘 + 동작(결제) 확인 타이틀
- 상황에 따라 경고 ⚠️ 뱃지 사용

### 2. 컨텐츠 & 상태 표시
| 요소 | 설명 |
|------|------|
| 안내 문구 | 기능 실행에 필요한 내용 고지 |
| 소모 / 잔여 | 예상 차감액과 차감 후 예상 잔액 표시 (결제 신뢰도) |
| 멤버십 혜택 | 멤버십 횟수 소진 중이면 토큰 대신 횟수 표기 |

### 3. 액션 버튼
| 요소 | 기능 (토큰 충분) | 기능 (토큰 부족) |
|------|------------------|------------------|
| 버튼 1 (Secondary) | 닫기 / 기능 취소 | 닫기 |
| 버튼 2 (Primary) | API 실행 (토큰 차감 로직 포함) | 상점(`/shop`) 페이지로 이동 |

## 상호작용
| 액션 | 동작 |
|------|------|
| [사용하기] 클릭 | 1. API 요청 2. 로딩 스피너 표시 3. 완료 시 해당 기능 동작 |
| [상점으로 가기] 클릭 | 모달을 닫고 `bm/shop` 페이지로 라우팅 |
| 모달 닫기 (배경 탭 등) | 작업 취소. 닫힘 |

## 관련 스펙
- 공통 모달 기본 틀: `../../ui/_shared/modal.md`
- 충전 화면: `../../ui/bm/shop.md`
