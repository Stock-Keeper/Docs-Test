# 2. 비즈니스 로직 상세화

### 2-1. 포트폴리오 관리

- **포트폴리오 최대 개수**:
    - 최대 개수: `5개 (로드맵 기준) - 팀 회의에서 최종 확정`
    - 기본 포트폴리오: `회원가입 시 '기본 포트폴리오' 1개 자동 생성`
    - 삭제 정책: `마지막 1개 삭제 시 빈 포트폴리오 자동 생성 (최소 1개 유지)`
- **포트폴리오 속성**:
    - 필수 정보: `포트폴리오 이름 (최대 20자), 생성일`
    - 선택 정보: `목표 설명/메모 (최대 100자), 색상 태그 (Phase 2)`
    - 정렬 순서: `사용자 지정 순서 또는 최근 수정일 기준`

### 2-2. 종목 관리

- **종목 추가 방식**:
    - 검색 방법: `한국투자증권 API를 통한 종목명 또는 종목코드 검색`
    - 검색 결과: `종목명, 종목코드, 현재가 표시`
    - 중복 체크: `동일 포트폴리오 내 동일 종목 중복 추가 불가 (수량만 수정 가능)`
- **입력 정보**:
    - 필수 입력: `보유 수량`
        - 일반 증권사: `정수 (1주 이상, 최대 1억주)`
        - 토스증권 등 소수점 거래 지원: `소수점 4자리까지 (예: 0.0331주, 최소 0.0001주)`
        - **팀 논의 필요**: `Phase 1에서 소수점 거래 지원 여부 결정`
    - 선택 입력 (Phase 1):
        - [ ]  평균 매입 단가 (원)
        - [ ]  총 매입 금액 (원)
        - [ ]  매입일
    - **팀 논의 필요**: `Phase 1에서 평균 단가/매입 금액 입력 여부 결정`
- **종목 삭제**:
    - 삭제 방식: `스와이프 또는 편집 모드에서 삭제 버튼`
    - 확인 절차: `삭제 확인 다이얼로그 표시 (실수 방지)`

### 2-3. 리밸런싱 알고리즘

- **목표 비율 설정**:
    - 입력 방식: `각 종목별 목표 비율 (%) 입력 또는 슬라이더`
    - 합계 검증: `전체 종목 목표 비율 합계 = 100% (자동 계산 또는 수동 조정)`
    - 미설정 시: `균등 분배 (예: 5종목이면 각 20%) 또는 현재 비율 유지`
- **리밸런싱 제안 조건**:
    - 임계값 설정:
        - 기본값: `목표 비율 대비 ±5% 초과 시 알림`
        - 사용자 지정: `±3%, ±5%, ±10% 중 선택 가능`
    - 계산 방식:
        1. 현재 각 종목의 평가금액 계산 (보유수량 × 현재가)
        2. 전체 포트폴리오 평가금액 계산
        3. 각 종목의 현재 비율 계산
        4. 목표 비율과 현재 비율 차이 계산
        5. 임계값 초과 종목에 대해 매수/매도 수량 제안
- **제안 내용**:
    - 표시 정보: `종목명, 현재 비율, 목표 비율, 권장 매수/매도 수량, 예상 금액`
    - 우선순위: `비율 차이가 큰 순서대로 정렬`
    - **팀 논의 필요**: `최소 리밸런싱 금액 설정 (예: 1만원 미만 조정은 무시)`

### 2-4. 실시간 시세 업데이트

- **업데이트 주기**:
    - 장중 (09:00-15:30): `30초~1분 간격 (API 호출 제한 고려)`
    - 장외 시간: `수동 새로고침 또는 업데이트 안 함`
    - 앱 백그라운드 상태: `업데이트 중단 (배터리 절약)`
- **데이터 캐싱**:
    - 캐시 유효기간: `30초~1분 (API 호출 최소화)`
    - 오프라인 모드: `마지막 조회 시세 표시 + '업데이트 필요' 안내`
- **API 호출 최적화**:
    - 화면 표시 종목만 조회: `현재 보고 있는 포트폴리오의 종목만 API 호출`
    - 배치 요청: `가능하면 여러 종목 한 번에 조회 (API 지원 시)`
    - **팀 논의 필요**: `정확한 업데이트 주기 및 한투 API 호출 제한 확인 후 결정`

### 2-5. 알림 기능 (Phase 1)

- **알림 조건**:
    - 리밸런싱 필요: `목표 비율 대비 임계값 초과 시`
    - 사용자 설정 주기: `매일, 매주, 2주마다, 한 달마다 중 선택`
    - 알림 시간: `사용자 지정 시간 (예: 장 마감 후 16:00)`
- **알림 내용**:
    - 제목: `[포트폴리오명] 리밸런싱이 필요합니다`
    - 내용: `n개 종목의 비율 조정이 필요합니다`
    - 액션: `알림 탭 시 해당 포트폴리오 상세 화면으로 이동`
- **알림 설정**:
    - 전체 알림 ON/OFF: `설정 메뉴에서 제어`
    - 포트폴리오별 알림 설정: `각 포트폴리오마다 개별 설정 가능`
    - **팀 논의 필요**: `푸시 알림 vs 앱 내 알림 vs 둘 다`

### 2-6. 데이터 검증 및 에러 처리

- **입력 검증**:
    - 종목 수량:
        - 정수 모드: `1 이상의 정수, 최대 1억주`
        - 소수점 모드: `0.0001 이상, 소수점 4자리까지, 최대 1억주`
    - 포트폴리오 이름: `1\~20자, 특수문자 제한 (!@#\$%\^&\* 허용 안 함)`
    - 목표 비율: `0\~100%, 소수점 첫째 자리까지`
- **에러 시나리오**:
    - API 실패: `'시세 정보를 불러올 수 없습니다. 잠시 후 다시 시도해주세요.' 토스트 메시지`
    - 네트워크 오류: `오프라인 모드 전환 + 마지막 데이터 표시`
    - 서버 오류 (5xx): `'서버 점검 중입니다. 잠시 후 다시 시도해주세요.'`
    - 인증 만료: `자동 토큰 갱신 시도 → 실패 시 로그인 화면 이동`
- **데이터 동기화**:
    - 저장 시점: `종목 추가/수정/삭제 즉시 서버 동기화`
    - 충돌 처리: `서버 데이터 우선 (최신 타임스탬프 기준)`### 3. UI/UX 요구사항