# 4. 데이터 및 보안

### 4-1. 개인정보 처리방침

- **수집하는 개인정보 항목**:
    - 필수 정보:
        - Google 로그인: `이메일 주소, 이름, Google User ID`
        - 프로필: `닉네임/표시명`
    - 선택 정보:
        - `프로필 사진 (Google 프로필 사진 또는 사용자 업로드)`
    - 자동 수집 정보:
        - `기기 정보 (OS 버전, 기기 모델), 앱 사용 기록, 로그인 일시, IP 주소`
- **개인정보 수집 목적**:
    - 회원 가입 및 관리: `회원 식별, 서비스 이용 확인`
    - 서비스 제공: `포트폴리오 데이터 저장 및 관리, 리밸런싱 분석 제공`
    - 알림 서비스: `리밸런싱 알림 발송`
    - 서비스 개선: `앱 사용 패턴 분석, 오류 추적`
- **개인정보 보관 기간**:
    - 회원 정보: `회원 탈퇴 시까지 (탈퇴 후 즉시 삭제)`
    - 포트폴리오 데이터: `회원 탈퇴 시까지 (백업 포함 30일 이내 완전 삭제)`
    - 로그 데이터: `수집일로부터 90일 (보안 및 오류 추적 목적)`
    - 법령에 따른 보관:
        - 전자상거래법 (해당 시): `5년`
        - 통신비밀보호법: `3개월`
- **제3자 제공**:
    - 기본 원칙: `사용자 동의 없이 제3자에게 제공하지 않음`
    - 예외 사항: `법령에 의한 요구, 수사 목적`
- **개인정보 처리방침 문서**:
    - 작성 시기: `Phase 0 또는 Phase 1 초기 (앱 출시 전 필수)`
    - 공개 위치: `앱 내 설정 메뉴, 회원가입 화면, 웹사이트`
    - **팀 논의 필요**: `법률 검토 여부, 개인정보보호 담당자 지정`

### 4-2. 데이터베이스 스키마 및 보안

- **데이터베이스 구조**:
    - **users 테이블** (사용자 정보):
        - id (PK, UUID)
        - email (Unique, NOT NULL)
        - name (NOT NULL)
        - google_id (Unique, NOT NULL)
        - profile_image_url (Nullable)
        - created_at (TIMESTAMP)
        - updated_at (TIMESTAMP)
    - **portfolios 테이블** (포트폴리오):
        - id (PK, UUID)
        - user_id (FK -> users.id)
        - name (NOT NULL, MAX 20자)
        - description (Nullable, MAX 100자)
        - is_default (BOOLEAN, DEFAULT false)
        - display_order (INT)
        - created_at (TIMESTAMP)
        - updated_at (TIMESTAMP)
    - **stocks 테이블** (종목 정보):
        - id (PK, UUID)
        - portfolio_id (FK -> portfolios.id)
        - stock_code (NOT NULL, 종목코드)
        - stock_name (NOT NULL)
        - quantity (DECIMAL(15,4), NOT NULL) -- 소수점 거래 지원
        - average_price (DECIMAL(15,2), Nullable) -- Phase 1에서 결정
        - target_ratio (DECIMAL(5,2), Nullable) -- 목표 비율 (0~100%)
        - created_at (TIMESTAMP)
        - updated_at (TIMESTAMP)
    - **notifications 테이블** (알림 설정):
        - id (PK, UUID)
        - portfolio_id (FK -> portfolios.id)
        - is_enabled (BOOLEAN, DEFAULT false)
        - frequency (ENUM: daily, weekly, biweekly, monthly)
        - notification_time (TIME)
        - threshold (DECIMAL(5,2), DEFAULT 5.0) -- 임계값 (%)
        - created_at (TIMESTAMP)
        - updated_at (TIMESTAMP)
- **데이터베이스 보안**:
    - [ ]  암호화: `AWS RDS 저장 데이터 암호화 (AES-256)`
    - [ ]  전송 암호화: `TLS/SSL 연결 강제`
    - [ ]  접근 제어: `최소 권한 원칙, DB 사용자별 권한 분리`
    - [ ]  IP 화이트리스트: `특정 IP에서만 DB 접근 허용`
    - [ ]  정기 백업: `매일 자동 백업, 7일 보관`

### 4-3. 데이터 백업 및 복구

- **백업 정책**:
    - 자동 백업:
        - 주기: `매일 새벽 3시 (KST)`
        - 보관 기간: `7일 (7세대 백업 유지)`
        - 저장 위치: `AWS RDS 자동 백업 + S3 별도 보관`
    - 수동 백업:
        - 시점: `주요 업데이트 전, 데이터 마이그레이션 전`
        - 보관 기간: `30일`
- **복구 방안**:
    - Point-in-Time Recovery: `최근 7일 내 특정 시점으로 복구 가능`
    - 재해 복구 (DR): `Multi-AZ 배포로 자동 장애 조치 (Phase 2)`
    - 복구 테스트: `분기별 1회 백업 복구 테스트 수행`
- **데이터 손실 방지**:
    - 트랜잭션 처리: `모든 중요 작업은 DB 트랜잭션으로 처리`
    - 논리적 삭제: `실제 삭제 대신 deleted_at 컬럼으로 소프트 삭제 (Phase 2)`
    - 버전 관리: `주요 데이터 변경 이력 저장 (Phase 2)`

### 4-4. 애플리케이션 보안

- **인증 및 인가**:
    - OAuth 2.0: `Google 소셜 로그인 (HTTPS 필수)`
    - JWT 토큰:
        - Access Token: `1시간 유효, HS256 암호화`
        - Refresh Token: `14일 유효, DB에 해시값 저장`
        - 토큰 저장: `React Native Secure Storage (암호화)`
    - 세션 관리: `동시 로그인 5개 기기 제한 (Phase 2)`
- **API 보안**:
    - [ ]  HTTPS 강제: `모든 API 요청은 HTTPS만 허용`
    - [ ]  Rate Limiting: `동일 IP에서 분당 60회 요청 제한`
    - [ ]  API Key 보호: `환경변수로 관리, 코드에 하드코딩 금지`
    - [ ]  CORS 설정: `허용된 도메인만 접근 가능`
    - [ ]  Input Validation: `모든 입력값 서버 측 검증`
- **모바일 앱 보안**:
    - [ ]  Code Obfuscation: `앱 배포 시 코드 난독화 (ProGuard/R8)`
    - [ ]  Certificate Pinning: `API 서버 인증서 고정 (Phase 2)`
    - [ ]  Jailbreak/Root 감지: `탈옥/루팅 기기 경고 또는 차단 (Phase 2)`
    - [ ]  민감 데이터 보호: `Secure Storage 사용, 로그에 민감 정보 미포함`
- **보안 취약점 대응**:
    - SQL Injection: `ORM(JPA) 사용, Prepared Statement 필수`
    - XSS: `입력값 sanitization, React Native 기본 방어`
    - CSRF: `토큰 기반 인증으로 자동 방어`
    - 무차별 대입 공격: `로그인 실패 5회 시 5분 계정 잠금`

### 4-5. 규정 준수 및 인증

- **개인정보보호법 준수**:
    - [ ]  개인정보 처리방침 공개
    - [ ]  개인정보 수집 동의 절차
    - [ ]  개인정보 열람/정정/삭제 요청 처리 프로세스
    - [ ]  개인정보보호 책임자 지정 (Phase 1 출시 전)
- **정보보호 관리체계**:
    - Phase 1: `기본 보안 정책 수립`
    - Phase 2: `ISMS-P 인증 검토 (사용자 10만명 이상 시)`
- **앱 스토어 정책 준수**:
    - [ ]  App Store Review Guidelines (iOS)
    - [ ]  Google Play 정책 (Android)
    - [ ]  개인정보 처리방침 링크 제공
    - [ ]  데이터 수집 및 사용 명시

### 4-6. 보안 모니터링 및 대응

- **로그 관리**:
    - 수집 로그:
        - 접근 로그: `API 요청 시간, IP, 엔드포인트, 응답 코드`
        - 인증 로그: `로그인/로그아웃 시도, 토큰 갱신`
        - 에러 로그: `서버 에러, 예외 상황`
    - 로그 보관: `90일 (압축 보관)`
    - 로그 분석: `AWS CloudWatch 또는 ELK Stack (Phase 2)`
- **보안 이벤트 모니터링**:
    - 실시간 알림:
        - 비정상적인 로그인 시도 (다른 국가, 여러 기기)
        - API Rate Limit 초과
        - 서버 에러 급증
    - 주기적 점검:
        - 주간: `로그 검토, 이상 패턴 확인`
        - 월간: `보안 취약점 스캔`
        - 분기: `침투 테스트 (Phase 2)`
- **보안 사고 대응**:
    - 대응 프로세스:
        1. 사고 감지 및 확인
        2. 즉시 영향 범위 파악
        3. 긴급 조치 (계정 잠금, 서비스 일시 중단 등)
        4. 사용자 공지 (개인정보 유출 시 필수)
        5. 원인 분석 및 재발 방지
    - 연락 체계: `보안 책임자 지정, 24시간 연락 가능 체계 구축 (Phase 2)`

### 4-7. 팀 논의 필요 사항

- [ ]  평균 매입 단가/총 매입 금액 저장 여부 (stocks 테이블)
- [ ]  개인정보보호 담당자 지정 시점 및 역할
- [ ]  ISMS-P 인증 필요성 및 시점 (비용 vs 신뢰도)
- [ ]  Certificate Pinning 적용 시점 (Phase 1 vs Phase 2)
- [ ]  로그 분석 도구 선택 (CloudWatch vs ELK Stack vs 무료 도구)
- [ ]  보안 감사/침투 테스트 외주 여부 및 예산