# μ£Όμ‹ ν¬νΈν΄λ¦¬μ¤ & DB μ¤ν‚¤λ§ μ™„λ²½ μ΄ν•΄ κ°€μ΄λ“

> ν”„λ΅ νΈμ—”λ“ κ°λ°μκ°€ UXλ¥Ό μ„¤κ³„ν•κΈ° μ„ν•΄ μ•μ•„μ•Ό ν•  **μ£Όμ‹ λ„λ©”μΈ κ°λ…**, **DB ν…μ΄λΈ” κ΄€κ³„**, **κ° μ»¬λΌμ μλ―Έ**λ¥Ό ν• λ²μ— μ •λ¦¬ν• λ¬Έμ„μ…λ‹λ‹¤.

---

## 1. λ¨Όμ €, μ‹¤μƒν™ λΉ„μ λ΅ μ΄ν•΄ν•κΈ°

### 1.1 μ€ν–‰ vs μ¦κ¶μ‚¬

| μ€ν–‰ | μ¦κ¶μ‚¬ |
|------|--------|
| μκΈ ν†µμ¥ | **μ¦κ¶ κ³„μΆ** |
| ν„κΈ μ”κ³  | μ£Όμ‹ + μμκΈ(ν„κΈ) |
| μ΄μ²΄ | λ§¤μ/λ§¤λ„ |

> μ¦κ¶ κ³„μΆ = "μ£Όμ‹μ„ μ‚¬κ³ ν” μ μλ” ν†µμ¥"

### 1.2 ν¬νΈν΄λ¦¬μ¤λ€?

**ν¬νΈν΄λ¦¬μ¤ = λ‚΄κ°€ λ³΄μ ν• μ£Όμ‹λ“¤μ μ΅°ν•©**

λΉ„μ : **λ„μ‹λ½ κµ¬μ„±**

- π λ°¥ 40%, π¥© κ³ κΈ° 30%, π¥— μ•Όμ±„ 30%
- μ΄ λΉ„μ¨μ΄ "ν¬νΈν΄λ¦¬μ¤"

μ£Όμ‹μ—μ„λ”:

- μ‚Όμ„±μ „μ 40%, μ• ν” 30%, ν…μ¬λΌ 30%
- μ΄ λΉ„μ¨μ„ λ‚΄κ°€ μ •ν•λ‹¤ = **λ©ν‘ λΉ„μ¤‘**

### 1.3 λ¦¬λ°Έλ°μ‹±μ΄λ€?

**λ¦¬λ°Έλ°μ‹± = λΉ„μ¨μ΄ ν‹€μ–΄μ΅μ„ λ• λ‹¤μ‹ λ§μ¶”λ” κ²ƒ**

```
μ²μ (λ©ν‘):  μ‚Όμ„± 40%, μ• ν” 30%, ν…μ¬λΌ 30%
     β†“
(μ‚Όμ„± μ£Όκ°€ μƒμΉ)
     β†“
ν„μ¬:         μ‚Όμ„± 50%, μ• ν” 25%, ν…μ¬λΌ 25%
     β†“
λ¦¬λ°Έλ°μ‹±:     μ‚Όμ„± μΌλ¶€ λ§¤λ„ β†’ μ• ν”/ν…μ¬λΌ λ§¤μ
     β†“
κ²°κ³Ό:         μ‚Όμ„± 40%, μ• ν” 30%, ν…μ¬λΌ 30% β…
```

> **μ™?** ν• μΆ…λ©μ— μ λ¦¬λ©΄ μ„ν—ν•λ‹κΉ, κ· ν•μ„ μ μ§€ν•λ ¤κ³ 

---

## 2. ν…μ΄λΈ” κ΄€κ³„ ν•λμ— λ³΄κΈ°

```mermaid
erDiagram
    users ||--o{ accounts : "1:N μ—¬λ¬ μ¦κ¶κ³„μΆ λ³΄μ "
    users ||--o{ portfolios : "1:N μ—¬λ¬ ν¬νΈν΄λ¦¬μ¤"
    users ||--|| settings : "1:1 μ„¤μ •μ€ ν•λ‚"
    
    portfolios ||--o{ portfolio_entries : "1:N μ—¬λ¬ μΆ…λ©"
    portfolios ||--|| notification_settings : "1:1 μ•λ¦Όμ„¤μ •"
```

### κ΄€κ³„ ν•΄μ„

| κ΄€κ³„ | μλ―Έ | μ‹¤μƒν™ μμ‹ |
|------|------|-------------|
| `users β†’ accounts` | ν• μ‚¬λμ΄ μ—¬λ¬ μ¦κ¶μ‚¬ κ³„μΆ κ°€λ¥ | "λ‚λ” μ‚Όμ„±μ¦κ¶, ν‚¤μ›€μ¦κ¶ λ‘ λ‹¤ μ¨" |
| `users β†’ portfolios` | ν• μ‚¬λμ΄ μ—¬λ¬ ν¬νΈν΄λ¦¬μ¤ κ΄€λ¦¬ κ°€λ¥ | "μ€ν‡΄μ©, λ‹¨κΈ°ν¬μμ© λ”°λ΅ κ΄€λ¦¬" |
| `portfolios β†’ portfolio_entries` | ν• ν¬νΈν΄λ¦¬μ¤μ— μ—¬λ¬ μΆ…λ© | "μ€ν‡΄μ©μ— μ‚Όμ„±, μ• ν”, κµ­μ±„ λ‹΄μ" |
| `portfolios β†’ notification_settings` | ν¬νΈν΄λ¦¬μ¤λ§λ‹¤ μ•λ¦Ό μ„¤μ • | "μ€ν‡΄μ©λ§ μ•λ¦Ό λ°›μ„λ" |

---

## 3. ν…μ΄λΈ”λ³„ μƒμ„Έ ν•΄μ„¤

### 3.1 `users` - μ‚¬μ©μ μ •λ³΄

```sql
Table users {
  id integer [primary key]       -- κ³ μ  λ²νΈ (1, 2, 3...)
  email varchar [unique]         -- λ΅κ·ΈμΈ μ΄λ©”μΌ (μ¤‘λ³µ λ¶κ°€)
  nickname varchar               -- ν™”λ©΄μ— λ³΄μ—¬μ¤„ μ΄λ¦„
  provider enum('GOOGLE')        -- μ–΄λ””λ΅ λ΅κ·ΈμΈν–λ‚
  role varchar                   -- USER or ADMIN
  profile_image_url varchar      -- ν”„λ΅ν•„ μ‚¬μ§„ URL
  refresh_token text             -- λ΅κ·ΈμΈ μ μ§€μ© ν† ν°
  is_membership enum             -- λ¬΄λ£/ν”„λ΅/μ „λ¬Έκ°€ λ“±κΈ‰
  created_at / updated_at        -- κ°€μ…μΌ, μμ •μΌ
}
```

**π¨ ν”„λ΅ νΈ UX κ΄€μ :**

- `nickname`: ν—¤λ”μ— "μ•λ…•ν•μ„Έμ”, OOOλ‹"
- `profile_image_url`: ν”„λ΅ν•„ μ•„μ΄μ½ μ΄λ―Έμ§€
- `is_membership`: ν”„λ΅ κΈ°λ¥μ€ μ κΈ ν‘μ‹, μ—…κ·Έλ μ΄λ“ μ λ„

---

### 3.2 `accounts` - μ¦κ¶ κ³„μΆ

```sql
Table accounts {
  id integer [primary key]
  user_id integer [ref: > users.id]  -- λ„κµ¬ κ³„μΆ?
  brokerage_name varchar             -- "μ‚Όμ„±μ¦κ¶", "ν‚¤μ›€μ¦κ¶"
  account_number varchar             -- κ³„μΆλ²νΈ (μ•”νΈν™” μ €μ¥)
  access_token text                  -- μ¦κ¶μ‚¬ API μΈμ¦
  is_connected boolean               -- ν„μ¬ μ—°κ²° μƒνƒ
}
```

**μ™ λ”°λ΅ ν…μ΄λΈ”μΈκ°€?**
> ν• μ‚¬λμ΄ μ—¬λ¬ μ¦κ¶μ‚¬ κ³„μΆλ¥Ό κ°€μ§ μ μμΌλ‹κΉ!

**π¨ ν”„λ΅ νΈ UX κ΄€μ :**

- κ³„μΆ λ©λ΅ ν™”λ©΄: μΉ΄λ“λ΅ μ¦κ¶μ‚¬λ³„ ν‘μ‹
- `is_connected`: μ—°κ²°λ¨ πΆ / μ—°κ²° λκΉ€ π”΄  λ°°μ§€
- κ³„μΆ μ¶”κ°€ λ²„νΌ β†’ OAuth μΈμ¦ ν”λ΅μ°

---

### 3.3 `portfolios` - ν¬νΈν΄λ¦¬μ¤

```sql
Table portfolios {
  id integer [primary key]
  user_id integer [ref: > users.id]  -- λ„κµ¬ ν¬νΈν΄λ¦¬μ¤?
  name varchar                       -- "μ€ν‡΄ μ¤€λΉ„μ©", "μ©λ κµ΄λ¦¬κΈ°"
  description text                   -- μƒμ„Έ μ„¤λ…
  is_main boolean                    -- β­ λ©”μΈμΌλ΅ ν‘μ‹ν•  κ±΄κ°€
}
```

**β οΈ μ¤‘μ”ν• μ„¤κ³„ μλ„:**

- **ν¬νΈν΄λ¦¬μ¤ β‰  κ³„μΆ**: κ³„μΆλ” μ¦κ¶μ‚¬ μ‹¤μ  κ³„μΆ, ν¬νΈν΄λ¦¬μ¤λ” "λ‚΄κ°€ λ§λ“  κ°€μƒ λ¶„λ¥"
- κ°™μ€ κ³„μΆμ μΆ…λ©μ„ μ—¬λ¬ ν¬νΈν΄λ¦¬μ¤μ— λ‚λ  κ΄€λ¦¬ν•  μλ„ μμ

**π¨ ν”„λ΅ νΈ UX κ΄€μ :**

- `is_main = true`μΈ ν¬νΈν΄λ¦¬μ¤λ” ν™ ν™”λ©΄μ— ν¬κ² ν‘μ‹
- ν¬νΈν΄λ¦¬μ¤ λ¦¬μ¤νΈ: νƒ­ λλ” μΉ΄λ“ ν•νƒ

---

### 3.4 `portfolio_entries` - ν¬νΈν΄λ¦¬μ¤ λ‚΄ μΆ…λ©

```sql
Table portfolio_entries {
  id integer [primary key]
  portfolio_id integer [ref: > portfolios.id]
  group enum                -- "κµ­λ‚΄μ£Όμ‹", "ν•΄μ™Έμ£Όμ‹", "ETF" λ“±
  stock_name varchar        -- "μ‚Όμ„±μ „μ", "AAPL"
  bought_price float        -- λ‚΄κ°€ μ‚° ν‰κ·  κ°€κ²©
  current_quantity float    -- ν„μ¬ λ³΄μ  μλ‰ (μ†μμ : ν•΄μ™Έμ£Όμ‹)
  current_weight float      -- ν„μ¬ λΉ„μ¤‘ (%)
  target_weight float       -- λ©ν‘ λΉ„μ¤‘ (%)
}
```

**π’΅ ν•µμ‹¬ μ»¬λΌ μ„¤λ…:**

| μ»¬λΌ | μ™ float? | μμ‹ |
|------|----------|------|
| `current_quantity` | ν•΄μ™Έμ£Όμ‹μ€ μ†μμ  κ±°λ κ°€λ¥ | ν…μ¬λΌ 0.5μ£Ό |
| `current_weight` | λ°±λ¶„μ¨μ΄λ―€λ΅ μ†μμ  ν•„μ” | 33.33% |
| `target_weight` | λ©ν‘ λΉ„μ¨λ„ μ†μμ  | 30.00% |
| `bought_price` | μ†μμ  λ‹¨μ„ κ°€κ²© | $193.45 |

**π¨ ν”„λ΅ νΈ UX κ΄€μ :**

- ν…μ΄λΈ”/λ¦¬μ¤νΈλ΅ μΆ…λ© ν‘μ‹
- `current_weight` vs `target_weight` λΉ„κµ β†’ λ§‰λ€ κ·Έλν”„
- μ°¨μ΄κ°€ ν¬λ©΄ π”΄ λΉ¨κ°„μƒ‰μΌλ΅ κ²½κ³ 

---

### 3.5 `notification_settings` - μ•λ¦Ό μ„¤μ •

```sql
Table notification_settings {
  portfolio_id integer [ref: - portfolios.id]  -- 1:1 κ΄€κ³„
  is_enabled boolean
  alert_cycle enum('WEEKLY')      -- λ§¤μ£Ό, λ§¤μ›” λ“±
  alert_time time                 -- 09:00, 18:00 λ“±
  threshold_percentage float      -- Β±20% λ„μΌλ©΄ μ•λ¦Ό
}
```

**`ref: -` μλ―Έ:**
> `-`λ” 1:1 κ΄€κ³„λ¥Ό λ»ν•¨ (ν¬νΈν΄λ¦¬μ¤λ‹Ή μ•λ¦Όμ„¤μ • ν•λ‚)

**π¨ ν”„λ΅ νΈ UX κ΄€μ :**

- ν¬νΈν΄λ¦¬μ¤ μƒμ„Έ ν™”λ©΄ β†’ μ•λ¦Ό μ„¤μ • ν† κΈ€
- μ„κ³„κ°’ μ¬λΌμ΄λ”: 5% ~ 50%
- "λ§¤μ£Ό μ›”μ”μΌ μ¤μ „ 9μ‹μ— μ•λ¦Ό" ν•νƒλ΅ ν‘μ‹

---

### 3.6 `settings` - μ „μ—­ μ„¤μ •

```sql
Table settings {
  user_id integer [ref: > users.id]  -- 1:1
  is_nofitication boolean            -- μ „μ²΄ μ•λ¦Ό ON/OFF
  is_privacy boolean                 -- κ°μΈμ •λ³΄ λ™μ
}
```

**ν¬νΈν΄λ¦¬μ¤ μ•λ¦Ό vs μ „μ—­ μ•λ¦Ό:**

- `notification_settings`: νΉμ • ν¬νΈν΄λ¦¬μ¤ μ•λ¦Ό
- `settings.is_notification`: μ•± μ „μ²΄ μ•λ¦Ό ON/OFF (λ§μ¤ν„° μ¤μ„μΉ)

---

## 4. λ¦¬λ°Έλ°μ‹± κ³„μ‚° λ΅μ§

### 4.1 ν•µμ‹¬ κ³µμ‹

```
λ¦¬λ°Έλ°μ‹±_κΈμ•΅ = (μ΄μμ‚° Γ— λ©ν‘λΉ„μ¤‘) - ν„μ¬ν‰κ°€μ•΅
λ¦¬λ°Έλ°μ‹±_μλ‰ = λ¦¬λ°Έλ°μ‹±_κΈμ•΅ Γ· ν„μ¬κ°€
```

### 4.2 μμ‹

| μΆ…λ© | ν„μ¬κ°€ | λ³΄μ  | ν„μ¬λΉ„μ¤‘ | λ©ν‘λΉ„μ¤‘ | μ΅°μ • |
|------|--------|------|---------|---------|------|
| μ‚Όμ„± | 7λ§μ› | 10μ£Ό | 50% | 40% | -2μ£Ό λ§¤λ„ |
| μΉ΄μΉ΄μ¤ | 5λ§μ› | 10μ£Ό | 35% | 40% | +1μ£Ό λ§¤μ |
| ν„κΈ | - | - | 15% | 20% | +5% ν™•λ³΄ |

```
μ΄μμ‚° = 70λ§ + 50λ§ + 20λ§ = 140λ§μ›

μ‚Όμ„± λ©ν‘κΈμ•΅ = 140λ§ Γ— 40% = 56λ§μ›
μ‚Όμ„± ν„μ¬κΈμ•΅ = 70λ§μ›
β†’ 14λ§μ› ν”μ•„μ•Ό ν•¨ = 2μ£Ό λ§¤λ„
```

---

## 5. ν”„λ΅ νΈμ—”λ“ UX μ„¤κ³„ μ²΄ν¬λ¦¬μ¤νΈ

### 5.1 ν™”λ©΄λ³„ ν•„μ” λ°μ΄ν„°

| ν™”λ©΄ | ν•„μ” ν…μ΄λΈ” | μ£Όμ” ν‘μ‹ μ •λ³΄ |
|------|------------|--------------|
| ν™ | portfolios, portfolio_entries | λ©”μΈ ν¬νΈν΄λ¦¬μ¤ μ”μ•½, μ΄ μμ‚° |
| ν¬νΈν΄λ¦¬μ¤ μƒμ„Έ | portfolio_entries | μΆ…λ©λ³„ λΉ„μ¤‘, λ¦¬λ°Έλ°μ‹± μ μ• |
| κ³„μΆ κ΄€λ¦¬ | accounts | μ¦κ¶μ‚¬λ³„ κ³„μΆ λ©λ΅, μ—°κ²° μƒνƒ |
| μ„¤μ • | settings, notification_settings | μ•λ¦Ό ν† κΈ€, μ£ΌκΈ° μ„¤μ • |
| ν”„λ΅ν•„ | users | λ‹‰λ„¤μ„, μ΄λ©”μΌ, λ“±κΈ‰ |

### 5.2 UX κ³ λ ¤μ‚¬ν•­

1. **μ‹¤μ‹κ°„ vs μΊμ‹**: ν„μ¬κ°€λ” API νΈμ¶ ν•„μ”, λΉ„μ¤‘ κ³„μ‚°μ€ ν”„λ΅ νΈμ—μ„
2. **μ†μμ  ν‘μ‹**: λΉ„μ¤‘μ€ μ†μμ  λ‘μ§Έμλ¦¬ (33.33%)
3. **μƒ‰μƒ μ½”λ“**:
   - ν„μ¬λΉ„μ¤‘ > λ©ν‘λΉ„μ¤‘: π”΄ λ§¤λ„ ν•„μ”
   - ν„μ¬λΉ„μ¤‘ < λ©ν‘λΉ„μ¤‘: πΆ λ§¤μ ν•„μ”
   - μ°¨μ΄ μ μ: β μ μ§€

---

## 6. μ¤ν‚¤λ§ κ°μ„  μ μ•

ν„μ¬ μ¤ν‚¤λ§λ¥Ό κ²€ν† ν• κ²°κ³Ό λ‡ κ°€μ§€ κ°μ„ μ μ΄ μμ–΄μ”:

### 6.1 `portfolio_entries` λ³΄μ™„

```diff
Table portfolio_entries {
  ...
+ stock_code varchar     // μΆ…λ©μ½”λ“ (005930, AAPL)
+ currency enum          // KRW, USD
+ current_price float    // ν„μ¬κ°€ (μΊμ‹μ©)
+ price_updated_at timestamp  // ν„μ¬κ°€ κ°±μ‹  μ‹κ°
}
```

**μ΄μ **: ν„μ¬κ°€λ¥Ό μ €μ¥ν•΄μ•Ό λΉ„μ¤‘ κ³„μ‚°μ΄ κ°€λ¥ν•κ³ , μΆ…λ©μ½”λ“κ°€ μμ–΄μ•Ό APIλ΅ μ‹μ„Έ μ΅°ν

### 6.2 `accounts`μ™€ `portfolios` μ—°κ²°?

ν„μ¬ μ¤ν‚¤λ§μ—μ„λ” ν¬νΈν΄λ¦¬μ¤μ™€ κ³„μΆκ°€ **μ§μ ‘ μ—°κ²°λμ–΄ μμ§€ μ•μ**.

- μλ„μ μ΄λΌλ©΄: "κ°€μƒ ν¬νΈν΄λ¦¬μ¤"λ΅ μ‹¤μ  κ³„μΆμ™€ λ¬΄κ΄€ν•κ² κ΄€λ¦¬
- μ—°κ²°μ΄ ν•„μ”ν•λ©΄: `portfolios`μ— `account_id` μ¶”κ°€

---

## λ§λ¬΄λ¦¬

### ν•µμ‹¬ μ”μ•½ π“

1. **κ³„μΆ** = μ‹¤μ  μ¦κ¶μ‚¬ κ³„μΆ (λμ΄ μλ” κ³³)
2. **ν¬νΈν΄λ¦¬μ¤** = κ°€μƒμ μΆ…λ© λ¬¶μ (κ΄€λ¦¬ λ‹¨μ„)
3. **λ¦¬λ°Έλ°μ‹±** = λΉ„μ¤‘μ΄ ν‹€μ–΄μ§€λ©΄ λ‹¤μ‹ λ§μ¶”λ” κ²ƒ
4. **1:N κ΄€κ³„** = usersβ†’accounts, usersβ†’portfolios, portfoliosβ†’entries
5. **1:1 κ΄€κ³„** = portfoliosβ†’notification_settings, usersβ†’settings

### λ‹¤μ λ‹¨κ³„ π€

μ΄μ  μ΄ μ¤ν‚¤λ§λ¥Ό λ°”νƒ•μΌλ΅:

- ν™”λ©΄ μ„¤κ³„(μ™€μ΄μ–΄ν”„λ μ„) μ‘μ„±
- API μ—”λ“ν¬μΈνΈ μ •μ
- μƒνƒκ΄€λ¦¬ κµ¬μ΅° μ„¤κ³„

μ§λ¬Έ μμΌλ©΄ μ–Έμ λ“  λ¬Όμ–΄λ΄μ”! π
