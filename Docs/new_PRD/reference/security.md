# 보안 및 개인정보보호

## 요약 ⚡

- Google OAuth 2.0 인증 + JWT 토큰 (Access 1시간, Refresh 14일)
- AWS RDS 저장 데이터 암호화 (AES-256) + TLS/SSL 전송 암호화
- HTTPS 강제, Rate Limiting (60회/분), Input Validation
- 개인정보처리방침 공개, 개인정보보호법 준수
- [P2-고려] Certificate Pinning, Jailbreak/Root 감지, ISMS-P 인증

---

## Phase 1 (현재)

### 보안 목표

| 목표 | 설명 |
|------|------|
| 기밀성 | 사용자 데이터 무단 접근 방지 (암호화) |
| 무결성 | 데이터 변조 방지 (서명, 검증) |
| 가용성 | 서비스 안정성 보장 (백업, DR) |
| 인증/인가 | 올바른 사용자만 접근 (OAuth, JWT) |
| 추적성 | 보안 이벤트 로그 기록 (모니터링) |

---

## 인증 및 인가

### Google OAuth 2.0

| 항목 | 내용 |
|------|------|
| 제공자 | Google Identity Platform |
| 프로토콜 | OAuth 2.0 (Authorization Code Flow) |
| Scope | `email`, `profile` |
| 리다이렉트 URI | `https://api.example.com/auth/google/callback` |
| HTTPS 필수 | 모든 OAuth 요청은 HTTPS |
| 에러 처리 | 사용자 동의 거부 시 안내 메시지 |

**플로우**
1. 사용자 "Google 로그인" 버튼 클릭
2. Google 로그인 페이지로 리다이렉트
3. 사용자 Google 계정으로 인증
4. Authorization Code 받아 백엔드로 전송
5. 백엔드에서 Access Token 교환
6. 사용자 정보 조회 → JWT 발급

### JWT 토큰

#### Access Token

| 항목 | 내용 |
|------|------|
| 유효기간 | 1시간 |
| 알고리즘 | HS256 (HMAC-SHA256) |
| Payload | `user_id`, `email`, `iat`, `exp` |
| 저장 위치 | React Native Secure Storage (암호화) |
| 갱신 방법 | Refresh Token으로 자동 갱신 |

**예시**
```json
{
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "email": "user@example.com",
  "iat": 1735635600,
  "exp": 1735639200
}
```

#### Refresh Token

| 항목 | 내용 |
|------|------|
| 유효기간 | 14일 |
| 저장 위치 | DB (해시값) + 클라이언트 Secure Storage |
| 갱신 방법 | `/auth/refresh` 엔드포인트 |
| 보안 | BCrypt 해시 저장, 재사용 불가 |
| 만료 처리 | 만료 시 재로그인 필요 |

**토큰 갱신 플로우**
1. Access Token 만료 시 API 요청 실패 (401)
2. 클라이언트가 Refresh Token으로 `/auth/refresh` 호출
3. 서버가 Refresh Token 검증 (DB 해시 비교)
4. 새 Access Token + Refresh Token 발급
5. 기존 Refresh Token 무효화

### 세션 관리

| 항목 | 내용 |
|------|------|
| 동시 로그인 제한 | [P2] 5개 기기까지 허용 |
| 로그아웃 | Access Token 폐기, Refresh Token DB 삭제 |
| 자동 로그아웃 | 14일 동안 미사용 시 자동 로그아웃 |
| 기기 관리 | [P2] 설정에서 로그인된 기기 목록 조회/삭제 |

---

## 애플리케이션 보안

### API 보안

| 항목 | 내용 |
|------|------|
| HTTPS 강제 | 모든 API 요청은 HTTPS (TLS 1.2+) |
| Rate Limiting | 동일 IP 60회/분, 초과 시 429 응답 |
| CORS | 허용된 도메인만 접근 (화이트리스트) |
| Input Validation | 모든 입력값 서버 측 검증 (길이, 형식, 타입) |
| SQL Injection | JPA/Hibernate ORM 사용, Prepared Statement |
| XSS | React Native 자동 이스케이프 |
| CSRF | JWT 토큰 기반 인증으로 자동 방어 |

**Rate Limiting 설정**
```yaml
# 일반 API
- 60 requests / minute / IP

# 로그인 API
- 5 requests / 5 minutes / IP

# 검색 API
- 100 requests / minute / user
```

### 모바일 앱 보안

#### Phase 1

| 항목 | 내용 |
|------|------|
| Code Obfuscation | ProGuard (Android), 빌드 시 자동 적용 |
| Secure Storage | React Native Keychain (iOS), EncryptedSharedPreferences (Android) |
| 민감 데이터 보호 | 로그에 비밀번호, 토큰, 개인정보 미포함 |
| API Key 보호 | 환경변수로 관리, 코드에 하드코딩 금지 |
| SSL Pinning | [P2] 인증서 고정 |

#### Phase 2

| 항목 | 내용 |
|------|------|
| Certificate Pinning | API 서버 SSL 인증서 고정 |
| Jailbreak/Root 감지 | 탈옥/루팅 기기 경고 또는 차단 |
| 앱 위변조 감지 | 서명 검증, 무결성 체크 |
| 안티 디버깅 | 디버거 탐지 및 차단 |

### 무차별 대입 공격 방지

| 항목 | 내용 |
|------|------|
| 로그인 실패 제한 | 5회 실패 시 5분 계정 잠금 |
| CAPTCHA | [P2] 로그인 실패 3회 이상 시 CAPTCHA |
| IP 차단 | 100회 이상 실패 시 IP 24시간 차단 |
| 알림 | 계정 잠금 시 이메일 알림 |

---

## 데이터베이스 보안

### 암호화

| 항목 | 내용 |
|------|------|
| 저장 데이터 암호화 | AWS RDS Encryption at Rest (AES-256) |
| 전송 암호화 | TLS/SSL 1.2+ (JDBC 연결 시 강제) |
| 백업 암호화 | 자동 백업도 AES-256 암호화 |
| 비밀번호 해시 | BCrypt (Cost Factor: 12) |

### 접근 제어

| 항목 | 내용 |
|------|------|
| 최소 권한 원칙 | 애플리케이션 DB 사용자는 SELECT, INSERT, UPDATE, DELETE만 |
| IP 화이트리스트 | 특정 IP (백엔드 서버, VPN)에서만 DB 접근 허용 |
| 포트 차단 | 3306 포트 외부 노출 금지 |
| 관리자 계정 | 별도 관리자 계정, MFA 필수 |

### 백업 및 복구

| 항목 | 내용 |
|------|------|
| 자동 백업 | 매일 새벽 3시 (KST) |
| 보관 기간 | 7일 (7세대 백업) |
| 저장 위치 | AWS RDS 자동 백업 + S3 별도 보관 |
| Point-in-Time Recovery | 최근 7일 내 특정 시점 복구 가능 |
| 재해 복구 (DR) | [P2] Multi-AZ 배포 |
| 복구 테스트 | 분기별 1회 |

---

## 개인정보보호

### 수집하는 개인정보

#### 필수 정보

| 항목 | 수집 경로 |
|------|----------|
| 이메일 주소 | Google 로그인 |
| 이름 | Google 로그인 |
| Google User ID | Google 로그인 |
| 닉네임/표시명 | 사용자 입력 |

#### 선택 정보

| 항목 | 수집 경로 |
|------|----------|
| 프로필 사진 | Google 프로필 또는 사용자 업로드 |

#### 자동 수집 정보

| 항목 | 내용 |
|------|------|
| 기기 정보 | OS 버전, 기기 모델, 앱 버전 |
| 로그 데이터 | 로그인 일시, IP 주소, 사용 기록 |
| 에러 로그 | 앱 크래시, API 에러 |

### 개인정보 처리 목적

| 목적 | 세부 내용 |
|------|----------|
| 회원 가입 및 관리 | 회원 식별, 서비스 이용 확인 |
| 서비스 제공 | 포트폴리오 관리, 리밸런싱 분석 |
| 알림 서비스 | 리밸런싱 알림 발송 |
| 서비스 개선 | 앱 사용 패턴 분석, 오류 추적 |

### 보관 기간

| 데이터 | 보관 기간 |
|--------|----------|
| 회원 정보 | 회원 탈퇴 시까지 |
| 포트폴리오 데이터 | 회원 탈퇴 시까지 (탈퇴 후 30일 이내 완전 삭제) |
| 로그 데이터 | 수집일로부터 90일 |
| 법령 보관 | 전자상거래법 5년, 통신비밀보호법 3개월 |

### 제3자 제공

| 원칙 | 내용 |
|------|------|
| 기본 원칙 | 사용자 동의 없이 제3자에게 제공하지 않음 |
| 예외 사항 | 법령에 의한 요구, 수사 목적 |

### 사용자 권리

| 권리 | 처리 방법 |
|------|----------|
| 열람 | 설정 > 프로필에서 확인 |
| 정정 | 설정 > 프로필 수정 |
| 삭제 | 설정 > 회원 탈퇴 (즉시 삭제) |
| 철회 | 회원 탈퇴 = 동의 철회 |

### 개인정보처리방침 문서

| 항목 | 내용 |
|------|------|
| 작성 시기 | Phase 1 출시 전 필수 |
| 공개 위치 | 앱 내 설정 메뉴, 회원가입 화면 |
| 업데이트 | 정책 변경 시 7일 전 공지 |
| 책임자 | 개인정보보호 책임자 지정 |

**필수 포함 내용**
- 수집하는 개인정보 항목 및 목적
- 보유 및 이용 기간
- 제3자 제공 (해당 시)
- 개인정보 처리 위탁 (해당 시)
- 사용자 권리 및 행사 방법
- 개인정보보호 책임자 연락처

---

## 보안 모니터링

### 로그 관리

#### 수집하는 로그

| 로그 타입 | 내용 |
|----------|------|
| 접근 로그 | API 요청 시간, IP, 엔드포인트, 상태 코드 |
| 인증 로그 | 로그인/로그아웃, 토큰 갱신, 실패 시도 |
| 에러 로그 | 서버 에러, 예외 상황, 스택 트레이스 |
| 보안 로그 | Rate Limit 초과, 비정상 접근 |

#### 로그 보관

| 항목 | 내용 |
|------|------|
| 보관 기간 | 90일 |
| 압축 | 7일 이전 로그 gzip 압축 |
| 저장 위치 | AWS CloudWatch Logs |
| 삭제 정책 | 90일 후 자동 삭제 |

#### 로그 분석

| 도구 | 용도 |
|------|------|
| AWS CloudWatch | 실시간 모니터링, 알림 설정 |
| [P2] ELK Stack | 로그 검색, 시각화, 대시보드 |

### 보안 이벤트 알림

#### 실시간 알림

| 이벤트 | 알림 조건 |
|--------|----------|
| 비정상 로그인 | 다른 국가, 여러 기기 동시 |
| API Rate Limit 초과 | 1분에 100회 이상 |
| 서버 에러 급증 | 5분간 100건 이상 |
| DB 접속 실패 | 3회 이상 연속 실패 |

#### 주기적 점검

| 주기 | 내용 |
|------|------|
| 주간 | 로그 검토, 이상 패턴 확인 |
| 월간 | 보안 취약점 스캔 |
| 분기 | [P2] 침투 테스트 |
| 연간 | 보안 정책 검토 및 업데이트 |

### 보안 사고 대응

#### 대응 프로세스

1. **사고 감지 및 확인**
   - 자동 알림 또는 사용자 신고
   - 보안 담당자 즉시 확인

2. **영향 범위 파악**
   - 영향받은 사용자 수, 데이터 범위
   - 공격 경로 및 취약점 분석

3. **긴급 조치**
   - 계정 잠금, IP 차단
   - 취약점 패치
   - 필요 시 서비스 일시 중단

4. **사용자 공지**
   - 개인정보 유출 시 즉시 공지 (법적 의무)
   - 앱 내 공지 + 이메일

5. **원인 분석 및 재발 방지**
   - 사고 보고서 작성
   - 보안 정책 업데이트

#### 연락 체계

| 역할 | 연락처 |
|------|--------|
| 보안 책임자 | [Phase 1 전 지정] |
| 개발팀 리더 | 24시간 연락 가능 |
| AWS 지원 | [P2] Enterprise Support |

---

## 규정 준수

### 개인정보보호법

| 항목 | 상태 |
|------|------|
| 개인정보 처리방침 공개 | Phase 1 출시 전 필수 |
| 개인정보 수집 동의 | 회원가입 시 명시적 동의 |
| 열람/정정/삭제 요청 처리 | 설정 메뉴에서 제공 |
| 개인정보보호 책임자 | Phase 1 출시 전 지정 |
| 파기 절차 | 탈퇴 시 즉시 삭제 |

### 정보보호 관리체계

| Phase | 내용 |
|-------|------|
| Phase 1 | 기본 보안 정책 수립 |
| Phase 2 | ISMS-P 인증 검토 (사용자 10만명 이상 시) |

### 앱 스토어 정책

| 스토어 | 필수 사항 |
|--------|----------|
| App Store (iOS) | 개인정보 처리방침, 데이터 수집 라벨 |
| Google Play (Android) | 개인정보 처리방침, 데이터 보안 섹션 |

---

## Phase 2+ (확장 고려사항)

### Phase 2 기능

- [P2] **Certificate Pinning**
  - API 서버 SSL 인증서 고정
  - 중간자 공격(MITM) 방어

- [P2] **Jailbreak/Root 감지**
  - 탈옥/루팅 기기 경고
  - 민감한 기능 제한

- [P2] **Multi-AZ 배포**
  - 고가용성 보장
  - 자동 장애 조치

- [P2] **ELK Stack 로그 분석**
  - 중앙 집중식 로그 관리
  - 보안 이벤트 시각화

### Phase 3 기능

- [P3] **2단계 인증 (2FA)**
  - SMS, TOTP 앱 지원
  - 로그인 시 추가 인증

- [P3] **생체 인증**
  - Face ID, Touch ID, 지문
  - 앱 실행 시 인증 옵션

- [P3] **ISMS-P 인증**
  - 정보보호 관리체계 인증
  - 사용자 10만명 이상 시

---

## 팀 논의 필요 사항

- [ ] 개인정보보호 책임자 지정 시점 및 역할
- [ ] Certificate Pinning 적용 시점 (Phase 1 vs Phase 2)
- [ ] ISMS-P 인증 필요성 및 시점 (비용 vs 신뢰도)
- [ ] 로그 분석 도구 선택 (CloudWatch vs ELK Stack)
- [ ] 보안 감사/침투 테스트 외주 여부 및 예산
- [ ] 법률 검토 필요성 (개인정보 처리방침, 이용약관)

---

## 체크리스트

### Phase 1 출시 전 필수

- [ ] Google OAuth 2.0 연동 완료
- [ ] JWT 토큰 발급/검증 로직 구현
- [ ] HTTPS 강제 적용
- [ ] Rate Limiting 적용
- [ ] AWS RDS 암호화 활성화
- [ ] 개인정보처리방침 작성 및 공개
- [ ] 개인정보보호 책임자 지정
- [ ] 자동 백업 설정 (7일 보관)
- [ ] 로그 수집 및 보관 설정 (90일)
- [ ] 보안 이벤트 알림 설정

### Phase 2 목표

- [ ] Certificate Pinning 적용
- [ ] Jailbreak/Root 감지
- [ ] Multi-AZ 배포
- [ ] ELK Stack 로그 분석
- [ ] 분기별 침투 테스트

---

## 관련 문서

- **인증**: `features/auth.md` - OAuth, JWT 구현
- **DB 스키마**: `reference/db-schema.md` - 보안 관련 컬럼
- **인프라**: `reference/infra.md#security` - AWS 보안 설정
- **API**: `reference/api-spec.md` - API 보안 헤더

---

> **작성일**: 2025-12-31  
> **Phase**: Phase 1 (MVP)  
> **담당**: Backend + Security
